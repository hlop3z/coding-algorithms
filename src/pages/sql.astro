---
import DocsLayout from '@/layouts/DocsLayout.astro';
import { sqlStatements } from '@/data/sql-notes';
---

<DocsLayout title="SQL">
  <h1 class="text-3xl font-bold mb-8">SQL</h1>

  <div class="overflow-x-auto">
    <table class="data-table">
      <thead>
        <tr>
          <th class="w-32">Statement</th>
          <th class="w-1/3">Description</th>
          <th>Example</th>
        </tr>
      </thead>
      <tbody>
        {sqlStatements.map((stmt, index) => (
          <tr>
            <td class="font-mono font-medium text-blue-600 dark:text-blue-400">{stmt.statement}</td>
            <td class="text-sm text-gray-600 dark:text-gray-400">{stmt.description}</td>
            <td>
              <div class="relative group">
                <code
                  id={`sql-code-${index}`}
                  class="block bg-gray-100 dark:bg-gray-800 p-2 pr-10 rounded text-sm font-mono overflow-x-auto"
                >
                  {stmt.example}
                </code>
                <button
                  type="button"
                  class="copy-btn absolute top-1 right-1 p-1.5 rounded bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 opacity-0 group-hover:opacity-100 transition-opacity"
                  data-target={`sql-code-${index}`}
                  aria-label="Copy to clipboard"
                >
                  <svg class="w-4 h-4 text-gray-600 dark:text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                  </svg>
                </button>
              </div>
            </td>
          </tr>
        ))}
      </tbody>
    </table>
  </div>
</DocsLayout>

<script>
  document.querySelectorAll('.copy-btn').forEach((btn) => {
    btn.addEventListener('click', async () => {
      const targetId = btn.getAttribute('data-target');
      const codeElement = document.getElementById(targetId!);
      const text = codeElement?.textContent?.trim() || '';

      try {
        await navigator.clipboard.writeText(text);

        // Show feedback
        const svg = btn.querySelector('svg');
        const originalPath = svg?.innerHTML;
        if (svg) {
          svg.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />';
          setTimeout(() => {
            svg.innerHTML = originalPath!;
          }, 1500);
        }
      } catch (err) {
        console.error('Failed to copy:', err);
      }
    });
  });
</script>
